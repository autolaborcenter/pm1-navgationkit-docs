# 建图导航

## 操作步骤：

以下步骤要求用户端已连接到机器人端

进入到桌面 SLAM 建图导航文件夹

![](imgs/slam-9.png)

## 一、 点击【开始建图】


RVIZ工具打开，能够看到地图中的 PM1。地图中，红色是前置激光雷达实时数据，黄色是后置激光雷达实时数据，颜色从白至黑为障碍物的几率是0%~100%。

![](imgs/slam-3.png)

使用手柄控制 PM1 行走。

![](imgs/gamepad_quick_start.gif)

> 更多手柄相关信息请参考[手柄遥控指南](/usedoc/pm1/user-guide/using-gamepad/doc)。

随着 PM1 的运动，地图逐渐构建完整，最终建图结果示意：

<img style="width:37%;" src="imgs/slam-4.png"/>

建图注意事项：

* 轮胎气不足影响里程计数据

* 运行速度不宜过快，由于激光扫描有一定的频率，车速低时雷达可以扫描到的点更多，构建的地图会更准确一些

* 走一个来回，增加激光雷达扫描次数，累计更多的数据

* 地图构建的质量也受环境限制，请尽量选择特征比较明显的环境，玻璃、镜子、楼道、空旷等场景会影响建图效果

* 构建完成的地图，会发现有些点会飞出，飞出的点可能是由于物体的表面不平或者有空隙激光直接穿越了过去

* 当场景很大特征不足的时候，需要规划建图路径时，应先走一个小回环，当回环成功后，可以再多走几圈，消除粒子在这个回环的多样性。接下来走下一个回环，直到把整个地图连通成一个大的回环

## 二、 建图完毕，点击【保存并停止建图】

## 三、 点击【开始导航】
RVIZ工具打开，建好的地图会自动加载。

注意：一定要点击【保存并停止建图】后完成建图（不能直接关闭RVIZ窗口），才能进行导航，否则会找不到地图文件产生报错。

<img style="width:50%;" src="imgs/slam-5.png"/>


##### 1. 初始化定位

使用手柄控制机器人行走一段距离，当激光雷达的数据与实时的环境匹配成功时，即为机器人找到在地图中的初始定位。

如果将机器人放置在建图的出发点，会能够帮助机器人加速初始化定位，但此步骤不是必须的。

<img style="width:50%;" src="imgs/slam-6.gif"/>

如上图所示，进行初始化定位操作后，机器人突然跳到了一个新地点，并且地图中的地点与真实环境中机器人位置一致，即为初始化成功，可进行下一步操作。

##### 2. 关闭键盘控制

<b style="color:red;">点击数字键【0】关闭键盘控制功能</b>（非小键盘0），控制方式将切换至导航程序控制，如不切换机器人接收到目标点命令后将不会自动导航行走。

##### 3. 给定目标点

点击 2D Nav Goal，指定目标位置，拉动鼠标，箭头方向是最终车辆运行至目标的车头朝向，鼠标松开，这样就完成了目标点的指定。

目标点给定后在地图中我们能看到一条线，这是规划好的路径。根据这个规划好的路径，PM1 向目标点行走。

当PM1已经到达目标点后，再一次使 2D Nav Goal 设置目标位置，PM1将去到下一个目标点。

<img style="width:50%;" src="imgs/slam-7.gif"/>



## 四、 点击【终止导航】，停止导航功能，导航结束。

之后在同一环境中需要再次使用导航功能时，无须重复建图，点击【开始导航】即可。


